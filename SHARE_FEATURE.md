# 小游戏分享功能实现说明

## 功能概述

本次更新为同频小游戏添加了完整的分享功能，包括：

1. **转发到朋友圈** - 用户可以将同频报告分享到微信朋友圈
2. **转发给好友** - 用户可以将同频报告转发给微信好友
3. **保存图片到本地** - 用户可以保存同频报告图片到本地相册

## 实现细节

### 1. 分享按钮界面

在查看好友同频报告的详情页面底部，添加了三个分享按钮：
- 绿色「朋友圈」按钮 - 分享到朋友圈
- 蓝色「转发好友」按钮 - 转发给好友
- 橙色「保存图片」按钮 - 保存图片到本地

### 2. 核心API使用

#### 朋友圈分享
```javascript
// 设置分享菜单支持朋友圈
wx.showShareMenu({
    withShareTicket: false,
    menus: ['shareTimeline']
});

// 监听朋友圈分享事件
wx.onShareTimeline(() => {
    return {
        title: '分享标题',
        imageUrl: '分享图片路径',
        query: 'from=timeline'
    };
});
```

#### 转发好友
```javascript
// 主动调起转发界面
wx.shareAppMessage({
    title: '分享标题',
    desc: '分享描述',
    imageUrl: '分享图片路径',
    query: 'from=friend'
});
```

#### 海报分享（保存图片）
```javascript
// 调用海报分享接口
wx.showShareImageMenu({
    path: '图片路径'
});
```

### 3. 分享图片生成

使用离屏Canvas生成分享图片：
- 图片尺寸：400x320（5:4比例，适合分享显示）
- 包含内容：同频报告标题、好友昵称、同频度百分比、报告摘要
- 底部标识："来自同频小游戏"

### 4. 文件修改说明

#### `/js/scene/shareTab.js`
- 添加了 `drawShareButtons()` 方法绘制分享按钮
- 添加了 `checkShareButtons()` 方法处理分享按钮点击
- 添加了 `shareToTimeline()` 方法实现朋友圈分享
- 添加了 `shareToFriend()` 方法实现好友转发
- 添加了 `saveImage()` 方法实现图片保存
- 添加了 `generateShareImage()` 方法生成分享图片
- 修改了 `showReportDetail()` 方法，在报告详情页面显示分享按钮
- 修改了 `handleTouch()` 方法，添加分享按钮点击处理

#### `/main.js`
- 更新了 `setShare()` 方法，添加朋友圈分享支持
- 在 `wx.showShareMenu()` 中添加了 `menus: ['shareAppMessage', 'shareTimeline']`
- 添加了 `wx.onShareTimeline()` 监听器

## 使用流程

1. 用户在分享标签页查看好友列表
2. 点击已解锁的好友报告，进入报告详情页面
3. 在报告详情页面底部看到三个分享按钮
4. 点击相应按钮执行分享操作：
   - **朋友圈**：设置分享内容后提示用户点击右上角菜单分享
   - **转发好友**：直接调起微信转发界面
   - **保存图片**：调起图片分享菜单，可保存到相册或分享到其他应用

## 注意事项

1. **平台兼容性**：朋友圈分享功能需要微信基础库 2.12.0 以上版本，且目前仅支持Android平台
2. **运营规范**：分享功能需遵守微信小程序平台运营规范，避免诱导分享等违规行为
3. **图片审核**：如需使用审核通过的分享图片，需要在MP管理后台配置
4. **错误处理**：所有分享方法都包含了错误处理，在功能不可用时会显示友好提示

## 技术要点

- 使用微信小游戏官方分享API
- 支持Canvas生成自定义分享图片
- 响应式按钮布局适配不同屏幕尺寸
- 完整的错误处理和用户反馈机制
- 符合微信分享最佳实践